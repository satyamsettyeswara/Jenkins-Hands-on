Helm Rollbacks - Handling Failed Deployments
Goal:
âœ… Use Helm Rollback to revert to a previous stable release
âœ… Automate rollback in Jenkins when deployment fails
âœ… Learn helm history & helm rollback commands

ğŸ”¹ Step 1ï¸âƒ£: Deploy an Application with Helm
Run the following Helm command:

sh
Copy
Edit
helm upgrade --install myapp-release ./myapp --namespace default
âœ… Verify deployment:

sh
Copy
Edit
helm list
ğŸ”¹ Step 2ï¸âƒ£: Check Deployment History
List all past deployments:

sh
Copy
Edit
helm history myapp-release
âœ” This will show revision numbers (e.g., REVISION 1, 2, 3).

ğŸ”¹ Step 3ï¸âƒ£: Simulate a Failure
Modify your Helm chart (values.yaml) to intentionally break the deployment:

yaml
Copy
Edit
replicaCount: 0
Now, upgrade the release:

sh
Copy
Edit
helm upgrade myapp-release ./myapp
Check the rollout status:

sh
Copy
Edit
kubectl get pods
ğŸš¨ The deployment should fail!

ğŸ”¹ Step 4ï¸âƒ£: Rollback to Previous Version
Find the last working revision number:

sh
Copy
Edit
helm history myapp-release
Rollback using:

sh
Copy
Edit
helm rollback myapp-release 1
âœ… Verify rollback:

sh
Copy
Edit
kubectl get pods
helm list
ğŸ”¹ Step 5ï¸âƒ£: Automate Rollback in Jenkins
Modify your Jenkinsfile:

groovy
Copy
Edit
pipeline {
    agent any
    environment {
        RELEASE_NAME = "myapp-release"
    }
    stages {
        stage('Deploy') {
            steps {
                script {
                    def deployStatus = sh(script: "helm upgrade --install $RELEASE_NAME ./myapp", returnStatus: true)
                    if (deployStatus != 0) {
                        echo "Deployment failed! Rolling back..."
                        sh "helm rollback $RELEASE_NAME 1"
                    }
                }
            }
        }
    }
}
âœ” If the deployment fails, Jenkins will automatically rollback to the last working version! ğŸš€

