Kubernetes Rollbacks with Helm in Jenkins
Goal:
âœ… Automate Helm Rollbacks with Jenkins
âœ… Revert to a previous deployment in case of failure

ğŸ”¹ Step 1ï¸âƒ£: Make a Change to Your Helm Chart
ğŸ”¹ Modify the image tag in myapp/values.yaml to an invalid version:

yaml
Copy
Edit
image:
  repository: nginx
  tag: "invalid-tag"
ğŸ”¹ Package the chart again:

sh
Copy
Edit
helm package myapp
âœ… This creates a new myapp-0.1.1.tgz

ğŸ”¹ Step 2ï¸âƒ£: Modify Your Jenkins Pipeline
1ï¸âƒ£ Go to Jenkins â†’ Open Your Helm Pipeline Job
2ï¸âƒ£ Modify the pipeline to include rollback logic:

groovy
Copy
Edit
pipeline {
    agent any
    environment {
        KUBE_TOKEN = credentials('k8s-token')
        KUBE_SERVER = 'https://kubernetes.default.svc'
        RELEASE_NAME = 'myapp'
    }
    stages {
        stage('Package Helm Chart') {
            steps {
                sh 'helm package myapp'
            }
        }
        stage('Deploy with Helm') {
            steps {
                script {
                    try {
                        sh '''
                        echo $KUBE_TOKEN | kubectl --server=$KUBE_SERVER --token-stdin config set-credentials jenkins-user
                        helm upgrade --install $RELEASE_NAME ./myapp-0.1.1.tgz
                        '''
                    } catch (Exception e) {
                        echo "Deployment failed! Rolling back..."
                        sh 'helm rollback $RELEASE_NAME 1'
                    }
                }
            }
        }
    }
}
ğŸ”¹ Step 3ï¸âƒ£: Run the Pipeline
ğŸ”¹ Trigger a build in Jenkins
âœ… Jenkins tries to deploy the bad image
âœ… Helm detects failure & rolls back automatically

