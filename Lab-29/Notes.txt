Automating Kubernetes Deployments with Helm in Jenkins
Goal:
âœ… Use Helm to manage Kubernetes deployments from Jenkins
âœ… Automate Helm chart deployments

ğŸ”¹ Step 1ï¸âƒ£: Install Helm on Your WSL Machine
ğŸ”¹ Run this command in your WSL terminal:

sh
Copy
Edit
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
ğŸ”¹ Verify the installation:

sh
Copy
Edit
helm version
âœ… You should see an output like:

css
Copy
Edit
version.BuildInfo{Version:"v3.x.x", ...}
ğŸ”¹ Step 2ï¸âƒ£: Create a Sample Helm Chart
We need a Helm chart to deploy an app.

1ï¸âƒ£ Run this in WSL:

sh
Copy
Edit
helm create myapp
2ï¸âƒ£ Modify myapp/values.yaml to change the image name:

yaml
Copy
Edit
image:
  repository: nginx
  tag: latest
3ï¸âƒ£ Package the chart:

sh
Copy
Edit
helm package myapp
âœ… This creates myapp-0.1.0.tgz

ğŸ”¹ Step 3ï¸âƒ£: Add Helm to Jenkins
1ï¸âƒ£ Install Helm Plugin (If Not Installed)
Go to Manage Jenkins â†’ Plugin Manager

Search for Helm

Install Kubernetes CLI & Helm plugin

2ï¸âƒ£ Add Kubernetes Credentials in Jenkins
We already added the Kubernetes token in the previous lab.

ğŸ”¹ Step 4ï¸âƒ£: Write the Jenkins Pipeline
1ï¸âƒ£ Go to Jenkins â†’ New Item â†’ Pipeline
2ï¸âƒ£ Paste this pipeline:

groovy
Copy
Edit
pipeline {
    agent any
    environment {
        KUBE_TOKEN = credentials('k8s-token')
        KUBE_SERVER = 'https://kubernetes.default.svc'
    }
    stages {
        stage('Package Helm Chart') {
            steps {
                sh 'helm package myapp'
            }
        }
        stage('Deploy with Helm') {
            steps {
                sh '''
                echo $KUBE_TOKEN | kubectl --server=$KUBE_SERVER --token-stdin config set-credentials jenkins-user
                helm install myapp ./myapp-0.1.0.tgz
                '''
            }
        }
    }
}
3ï¸âƒ£ Click Build Now

âœ… If successful, your Helm chart should be deployed to Kubernetes! ğŸ‰

