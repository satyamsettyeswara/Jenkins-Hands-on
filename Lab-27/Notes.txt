Jenkins + Docker + Kubernetes Together
Goal:
âœ… Use Docker inside a Kubernetes Jenkins agent
âœ… Run Docker commands in Jenkins pipeline
âœ… Ensure Docker works in a K8s pod

ğŸ”¹ Step 1ï¸âƒ£: Add Docker to the Kubernetes Jenkins Agent
We need a Jenkins agent that can run Docker inside Kubernetes.

1ï¸âƒ£ Go to Jenkins â†’ Manage Jenkins â†’ Configure Clouds
2ï¸âƒ£ Edit the existing Kubernetes cloud
3ï¸âƒ£ In Pod Templates, add a new Container Template:

Name: docker-agent

Image: docker:latest

Command to run: /bin/sh -c

Arguments: "sleep infinity"

Mount the Docker socket:

Host Path: /var/run/docker.sock

Mount Path: /var/run/docker.sock

Privileged Mode: âœ… Enable it

Label: k8s-docker-agent 4ï¸âƒ£ Click Save

ğŸ”¹ Step 2ï¸âƒ£: Test Docker Inside Kubernetes
1ï¸âƒ£ Go to Jenkins â†’ New Item â†’ Pipeline
2ï¸âƒ£ Paste this pipeline:

groovy
Copy
Edit
pipeline {
    agent {
        kubernetes {
            label 'k8s-docker-agent'
        }
    }
    stages {
        stage('Check Docker') {
            steps {
                sh 'docker version'
                sh 'docker images'
            }
        }
    }
}
3ï¸âƒ£ Click Build Now
âœ… You should see Docker info printed in the logs!

ğŸ”¹ Step 3ï¸âƒ£: Run a Docker Container in Kubernetes Agent
Let's create a simple Docker-based pipeline inside Kubernetes.

1ï¸âƒ£ Go to Jenkins â†’ New Item â†’ Pipeline
2ï¸âƒ£ Paste this pipeline:

groovy
Copy
Edit
pipeline {
    agent {
        kubernetes {
            label 'k8s-docker-agent'
        }
    }
    stages {
        stage('Run a Container') {
            steps {
                sh 'docker run --rm hello-world'
            }
        }
    }
}
3ï¸âƒ£ Click Build Now
âœ… You should see Hello from Docker!
